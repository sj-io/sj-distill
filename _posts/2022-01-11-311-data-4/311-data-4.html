<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>CE4: Extracting resolution codes</title>

  <meta property="description" itemprop="description" content="In this post I continue to clean up Memphis&#39;s code enforcement dataset by removing certain codes from the resolution summary."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-01-21"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-01-21"/>
  <meta name="article:author" content="Sarah Johnson"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="CE4: Extracting resolution codes"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="In this post I continue to clean up Memphis&#39;s code enforcement dataset by removing certain codes from the resolution summary."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="CE4: Extracting resolution codes"/>
  <meta property="twitter:description" content="In this post I continue to clean up Memphis&#39;s code enforcement dataset by removing certain codes from the resolution summary."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","repository_url"]}},"value":[{"type":"character","attributes":{},"value":["CE4: Extracting resolution codes"]},{"type":"character","attributes":{},"value":["In this post I continue to clean up Memphis's code enforcement dataset by removing certain codes from the resolution summary.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Sarah Johnson"]}]}]},{"type":"character","attributes":{},"value":["2022-01-21"]},{"type":"character","attributes":{},"value":["code enforcement"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://github.com/sj-io/sj-distill"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["311-data-4_files/anchor-4.2.2/anchor.min.js","311-data-4_files/bowser-1.9.3/bowser.min.js","311-data-4_files/distill-2.2.21/template.v2.js","311-data-4_files/header-attrs-2.11/header-attrs.js","311-data-4_files/jquery-3.6.0/jquery-3.6.0.js","311-data-4_files/jquery-3.6.0/jquery-3.6.0.min.js","311-data-4_files/jquery-3.6.0/jquery-3.6.0.min.map","311-data-4_files/popper-2.6.0/popper.min.js","311-data-4_files/tippy-6.2.7/tippy-bundle.umd.min.js","311-data-4_files/tippy-6.2.7/tippy-light-border.css","311-data-4_files/tippy-6.2.7/tippy.css","311-data-4_files/tippy-6.2.7/tippy.umd.min.js","311-data-4_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="311-data-4_files/header-attrs-2.11/header-attrs.js"></script>
  <script src="311-data-4_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="311-data-4_files/popper-2.6.0/popper.min.js"></script>
  <link href="311-data-4_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="311-data-4_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="311-data-4_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="311-data-4_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="311-data-4_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="311-data-4_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="311-data-4_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"CE4: Extracting resolution codes","description":"In this post I continue to clean up Memphis's code enforcement dataset by removing certain codes from the resolution summary.","authors":[{"author":"Sarah Johnson","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-01-21T00:00:00.000-06:00","citationText":"Johnson, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>CE4: Extracting resolution codes</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">code enforcement</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>In this post I continue to clean up Memphis’s code enforcement dataset by removing certain codes from the resolution summary.</p></p>
</div>

<div class="d-byline">
  Sarah Johnson  
  
<br/>2022-01-21
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#starting-code">Starting Code</a>
<ul>
<li><a href="#import-dataset">Import dataset</a></li>
<li><a href="#filter-for-ce-data-omit-nas">Filter for CE data, omit NAs</a></li>
<li><a href="#extract-numbers">Extract numbers</a></li>
</ul></li>
<li><a href="#omit-resolution-codes">Omit Resolution Codes</a>
<ul>
<li><a href="#attempt-1">Attempt 1</a></li>
<li><a href="#attempt-2">Attempt 2</a></li>
</ul></li>
<li><a href="#final-code">Final Code</a></li>
</ul>
</nav>
</div>
<p>This post is part of a series breaking down Memphis code enforcement data. <a href="https://sarahjohnson.io/posts/2021-12-03-311-data/">Part one</a> introduced the dataset and briefly explained the purpose of all 53 columns. <a href="https://sarahjohnson.io/posts/2021-12-04-311-data-2/">Part two</a> looked at how to import the dataset in R and do basic filtering to try and find housing-related requests. Since that post I have decided to take a different approach to tidying the dataset, but there’s still useful information, such as <a href="https://sarahjohnson.io/posts/2021-12-04-311-data-2/#filter-for-housing">the frequency of each request type for the service requests</a>.</p>
<p>In <a href="https://sarahjohnson.io/posts/2022-01-10-311-data-3/">part three</a> I clarified my goal and laid out plans for how I will tidy this dataset moving forward. Currently I am trying to extract important information from the <code>RESOLUTION_SUMMARY</code> variable, a catch-all, manually-entered column. Previously, I extracted dates, phone numbers, and references to other service requests into new columns. In this post I will remove instances where the <code>RESOLUTION_SUMMARY</code> duplicates information found in the <code>RESOLUTION_CODE</code> column.</p>
<h2 id="starting-code">Starting Code</h2>
<p>This section uses code from the <a href="https://sarahjohnson.io/posts/2021-12-04-311-data-2/">second</a> and <a href="https://sarahjohnson.io/posts/2022-01-10-311-data-3/">third</a> posts to get started. Please refer to those posts for more in-depth explanations of what I’m doing, or you can <a href="https://sarahjohnson.io/posts/2022-01-11-311-data-4/#omit-resolution-codes">skip ahead</a> to the new code.</p>
<h3 id="import-dataset">Import dataset</h3>
<p>To start, import the dataset. I’m still working with a version downloaded December 3, 2021, which is 53 columns and 1,311,942 rows. I’m altering some columns to all lower case, because it makes future data matching easier.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>

<span class='va'>zService_Requests_since_2016</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"../_data/Service_Requests_since_2016.csv"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>RESOLUTION_SUMMARY <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/case.html'>str_to_lower</a></span><span class='op'>(</span><span class='va'>RESOLUTION_SUMMARY</span><span class='op'>)</span>,
         RESOLUTION_CODE <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/case.html'>str_to_lower</a></span><span class='op'>(</span><span class='va'>RESOLUTION_CODE</span><span class='op'>)</span>,
         RESOLUTION_CODE_MEANING <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/case.html'>str_to_lower</a></span><span class='op'>(</span><span class='va'>RESOLUTION_CODE_MEANING</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="filter-for-ce-data-omit-nas">Filter for CE data, omit NAs</h3>
<p>Narrow the dataset for Code Enforcement. I also filtered <code>REQUEST_TYPE</code> for “derelict” and “miscellaneous”, the two request types relevant to rental housing.</p>
<p>For this post I’ll be working with three columns related to the resolution, and the <code>INCIDENT_NUMBER</code> (AKA service request number) as a key. I renamed the columns to make work faster.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>zCE</span> <span class='op'>&lt;-</span> <span class='va'>zService_Requests_since_2016</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>DEPARTMENT</span> <span class='op'>==</span> <span class='st'>"Code Enforcement"</span> <span class='op'>&amp;</span>
           <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>REQUEST_TYPE</span>, <span class='st'>"Misc|Derelict"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span>sr <span class='op'>=</span> <span class='va'>INCIDENT_NUMBER</span>,
         rc <span class='op'>=</span> <span class='va'>RESOLUTION_CODE</span>,
         rcm <span class='op'>=</span> <span class='va'>RESOLUTION_CODE_MEANING</span>,
         rs <span class='op'>=</span> <span class='va'>RESOLUTION_SUMMARY</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Of the 1.3 million rows in this dataset, 165,836 fall under Code Enforcement, and 62,470 of those are listed as “Miscellaneous” or “Substandard, Derelict Struc”. There were 14,902 rows omitted because they had an empty <code>RESOLUTION_SUMMARY</code>.</p>
<p>The <code>zCE</code> table has 4 columns and 47,568 rows.</p>
<h3 id="extract-numbers">Extract numbers</h3>
<p>Next I use the code from my last post to clean up the resolution summary. I remove instances of service request numbers, dates, tax sale numbers, and phone numbers and separate that information into separate columns.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vSR</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='st'>"\\b(sr)?\\d{7}\\b"</span>,
  <span class='st'>"(please )?(see|(ref|refer|reference)\\b( to)?)?( )?(\\b(see)?s[/ \\.]*r\\b|service request|ticket)( )?(#)?( )?(\\.)?"</span>,
  <span class='st'>"(please )?(see|(ref|refer|reference)\\b( to)?|reference)( )?(#)?( )?(\\.)?"</span>
<span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span>collapse <span class='op'>=</span> <span class='st'>"|"</span><span class='op'>)</span>

<span class='va'>vMonths</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"january"</span>, <span class='st'>"february"</span>, <span class='st'>"march"</span>, <span class='st'>"april"</span>, 
    <span class='st'>"may"</span>, <span class='st'>"june"</span>, <span class='st'>"july"</span>, <span class='st'>"august"</span>, 
    <span class='st'>"september"</span>, <span class='st'>"october"</span>, <span class='st'>"november"</span>, <span class='st'>"december"</span>,
    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\b"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"jan"</span>, <span class='st'>"feb"</span>, <span class='st'>"mar"</span>, <span class='st'>"apr"</span>, <span class='st'>"jun"</span>, <span class='st'>"jul"</span>, 
        <span class='st'>"aug"</span>, <span class='st'>"sept"</span>, <span class='st'>"oct"</span>, <span class='st'>"nov"</span>, <span class='st'>"dec"</span><span class='op'>)</span>,
      <span class='st'>"(\\.)?\\b"</span>
      <span class='op'>)</span>
    <span class='op'>)</span>

<span class='va'>vDate</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='st'>"\\b\\d{1,2}(:\\d{2})?(:\\d{2})?( )?(a(\\.)?m(\\.)?|p(\\.)?m(\\.)?)"</span>,
  <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='va'>vMonths</span>, <span class='st'>"( )?"</span>, <span class='st'>"\\d{1,2}"</span>, <span class='st'>"(nd|th|rd)?"</span>, <span class='st'>"((,)?( )?\\d{2,4})?"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\d{1,2}"</span>, <span class='st'>"(nd|th|rd)? "</span>, <span class='va'>vMonths</span>, <span class='st'>"((,)?( )?\\d{2,4})?"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\d{1,2}"</span>, <span class='st'>"\\W"</span>, <span class='va'>vMonths</span>, <span class='st'>"\\W"</span>, <span class='st'>"\\d{2,4}"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\d{1,2}"</span>, <span class='st'>"(nd|th|rd)?"</span>, <span class='st'>" of "</span>, <span class='va'>vMonths</span><span class='op'>)</span>,
  <span class='st'>"(?&lt;=(\\b|\\D))\\d{1,2}( )?\\W{1,2}\\d{1,2}( )?\\W( )?\\d{2}(?=\\b|\\D)"</span>,
  <span class='st'>"(?&lt;=(\\b|\\D))\\d{1,2}( )?\\W\\d{1,2}\\W( )?\\d{4}"</span>,
  <span class='st'>"\\b\\d{1,2}\\W{1,2}\\d{1,2}\\b"</span>,
  <span class='st'>"\\b\\d{1,2}\\W\\d{4}\\b"</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span>collapse <span class='op'>=</span> <span class='st'>"|"</span><span class='op'>)</span>

<span class='va'>vTax</span> <span class='op'>&lt;-</span> <span class='st'>"(?&lt;=tax sale( (number|2019))? )\\d{2}(\\.)?\\d{2}(?!(\\W)?\\d)"</span>
</code></pre>
</div>
</div>
<p>As mentioned in the last post, I am hiding the code used to extract phone numbers from blog posts due to privacy concerns.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>numbers</span> <span class='op'>&lt;-</span> <span class='va'>zCE</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    ref <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"\\b(sr)?\\d{7}\\b"</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"\\b(sr)?\\d{7}\\b"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_replace.html'>str_replace_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vSR</span>, <span class='st'>" "</span><span class='op'>)</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>rs</span>
    <span class='op'>)</span>,
    taxSale <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vTax</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vTax</span><span class='op'>)</span>,
    date <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vDate</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vDate</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vPH</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"( )*\\$|\\("</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>rs</span>,
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>rs</span>
    <span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_squish</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Since I’m cleaning up the resolution summary and resolution codes, I can remove rows where these columns are <em>NA</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>num</span> <span class='op'>&lt;-</span> <span class='va'>numbers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rc</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>In the last post I did not work with the resolution code column. Removing rows where this column was <em>NA</em> omitted an additional 14 rows.</p>
<p>The starting dataset is 45,333 rows and seven columns.</p>
<h2 id="omit-resolution-codes">Omit Resolution Codes</h2>
<p>While perusing the data, I noticed that frequently the only information entered in the resolution summary is the resolution code. To see this, compare the most common resolution codes and summaries.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>rcm</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 67 × 2
   rcm                                n
   &lt;chr&gt;                          &lt;int&gt;
 1 comp. v.o. - miscellaneous     11556
 2 case not justified             11446
 3 comp. v.o. - yard cleaned       5369
 4 closed void                     2831
 5 justified, active already file  2339
 6 closed, other                   1970
 7 closed, rehab                   1547
 8 case dismissed                  1412
 9 uncooperative                   1158
10 comp. v.o. bldg. repaired        929
# … with 57 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 16,085 × 2
   rs                                                             n
   &lt;chr&gt;                                                      &lt;int&gt;
 1 case not justified                                          2811
 2 comp. v.o. - miscellaneous                                  2667
 3 in compliance                                               1384
 4 comp. v.o. - yard cleaned                                   1360
 5 closed void                                                  658
 6 justified, active already file                               652
 7 resolved                                                     480
 8 active npa case                                              450
 9 at the time of inspection the violation has been corrected   440
10 violation has been corrected                                 427
# … with 16,075 more rows</code></pre>
</div>
<p>Since this information is already in its own column, we don’t need it duplicated.</p>
<h3 id="attempt-1">Attempt 1</h3>
<p>My first attempt was straightforward: if the resolution summary contained the same words found in the resolution code or code meaning, remove it from the summary. I use <code>str_remove()</code> to remove instances where this info is repeated.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dupCode</span> <span class='op'>&lt;-</span> <span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>rcm</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>rc</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"( )*\\$|\\("</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>rs</span>,
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>rs</span>
    <span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_squish</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>newNA</span> <span class='op'>&lt;-</span> <span class='va'>dupCode</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>num</span>, by <span class='op'>=</span> <span class='st'>"sr"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>sr</span>, <span class='va'>rc.x</span>, <span class='va'>rcm.x</span>, <span class='va'>rs.x</span>, <span class='va'>rs.y</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Removing instances where the resolution summary restated the resolution code or resolution code meaning cleared out the resolution summary of 11,106 rows, 23% of the starting <code>zCE</code> dataset.</p>
<p>The <code>newNA</code> dataset was created to double check my results to make sure I didn’t erroneously clear out any resolution summaries. The dataset takes rows where the new output is <em>NA</em> and joins in the original resolution summary (<code>rs.y</code>). I use the <code>count()</code> function to compact the 11,106 rows to show unique summaries.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>newNA</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>rs.y</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 51 × 2
   rs.y                    n
   &lt;chr&gt;               &lt;int&gt;
 1 closed void ,           1
 2 cr                      1
 3 cvobd                   1
 4 cvoid - closed void     1
 5 cvoid .                 1
 6 cvoid-                  1
 7 cvoid,                  1
 8 cvoid,closed void       1
 9 ja -                    1
10 ja , # , # &amp; #          1
# … with 41 more rows</code></pre>
</div>
<p>Of the 11K+ rows that are now <em>NA,</em> there are only 51 unique resolution summaries, and it appears most of those variations are from punctuation and symbols. Only a snippet of the old resolution summaries are shown here, but I can verify on the back-end that there were no rows with other information that were accidentally removed.</p>
<p>Now let’s see what remains in the 34,486 rows that still contain information in the resolution summary.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>todo</span> <span class='op'>&lt;-</span> <span class='va'>dupCode</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>todo</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 15,662 × 2
   rs                                                             n
   &lt;chr&gt;                                                      &lt;int&gt;
 1 in compliance                                               1389
 2 resolved                                                     480
 3 active npa case                                              451
 4 at the time of inspection the violation has been corrected   440
 5 violation has been corrected                                 429
 6 not justified at the time of inspection                      371
 7 not justified                                                330
 8 not justified at time of inspection                          228
 9 repairs made at time of inspection                           227
10 per inspector james                                          211
# … with 15,652 more rows</code></pre>
</div>
<p>It looks like there’s still plenty of rows that closely, but don’t exactly, match resolution codes. Rows that said “case not justified” were removed, but not rows that only said “not justified”.</p>
<p>For other rows, we might need to create a new resolution code. There is no resolution code for “in compliance” or “resolved”; these are often coded “closed, miscellaneous”. However, I think it would be useful to know if a request was closed because it was brought into compliance.</p>
<p>I also found that my code messed up some resolution summaries. The <code>str_remove()</code> removed partial word matches of codes found in the summary. So if a resolution code was “co”, it changed the word “in<strong>co</strong>rrect” to “inrrect” and “<strong>co</strong>unty” to “unty”.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>todo</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"inrrect"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 14 × 1
   rs                                                                 
   &lt;chr&gt;                                                              
 1 inrrect address given. .                                           
 2 inrrect address on original complaint. .                           
 3 citizen states address provided was inrrect, request will be resub…
 4 closed inrrect address .board and secure was issued with a follow …
 5 inrrect address                                                    
 6 inrrect property                                                   
 7 r. nelson #-, inrrect address written up for demolition and correc…
 8 inrrect entry                                                      
 9 inrrect entry                                                      
10 inrrect address . the correct address is 8165 macon road. per insp…
11 inrrect entry                                                      
12 inrrect entry                                                      
13 inrrect entry                                                      
14 inrrect entry                                                      </code></pre>
</div>
<p>Let’s find a way to rewrite this code and fix these problems.</p>
<h3 id="attempt-2">Attempt 2</h3>
<p>First, I will make sure that resolution codes and meanings do not partially match with words. Then, I will create an additional list of codes to add to the ones we are removing.</p>
<h4 id="no-partial-word-matches">No partial word matches</h4>
<p>In an <a href="https://sarahjohnson.io/posts/2022-01-11-311-data-4/#extract-numbers">earlier section</a>, I used <code>\\b</code> around the beginning and ends of words, which tells R to look for <strong>word boundaries</strong> and prevent partial matches. However, there’s no easy way (as far as I know) to include this in the <code>str_remove()</code> function. Instead, the easiest method is likely to create a list of all the resolution codes and meanings and add a <code>\\b</code> to the starts and ends of each.</p>
<p>To do this, I first create a table with only the resolution code and meaning columns. I pivot these into one column, and keep only uniques. I also omit the word “shelby” because it is frequently used outside of the codes and can cause problems later on.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>RC</span> <span class='op'>&lt;-</span> <span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rc</span>, <span class='va'>rcm</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>rcm</span>, <span class='va'>rc</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"remo"</span>, values_to <span class='op'>=</span> <span class='st'>"rcs"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rcs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>rcs</span> <span class='op'>!=</span> <span class='st'>"shelby"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>There are 136 unique resolution codes and meanings. Next I convert the column to a list of values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vRC</span> <span class='op'>&lt;-</span> <span class='va'>RC</span><span class='op'>$</span><span class='va'>rcs</span>
</code></pre>
</div>
</div>
<p>Now I can add <code>//b</code> to the beginning and end of each value with <code>str_c()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vRC1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\b"</span>, <span class='va'>vRC</span>, <span class='st'>"\\b"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span>collapse <span class='op'>=</span> <span class='st'>"|"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>To see if this worked, I run my code again and use my new list of values with <code>str_remove()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dupCode2</span> <span class='op'>&lt;-</span> <span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vRC1</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"( )*\\$|\\("</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>rs</span>,
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>rs</span>
    <span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_squish</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>dupCode2</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"incorrect"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 100 × 1
   rs                                                                 
   &lt;chr&gt;                                                              
 1 insufficent ;elevators working incorrect number no unit listed     
 2 incorrect address given. .                                         
 3 incorrect address on original complaint. .                         
 4 incorrect address                                                  
 5 incorrect address given for complaint.                             
 6 incorrect address. .                                               
 7 incorrect                                                          
 8 reissued for incorrect address.                                    
 9 insufficient incorrect unit number                                 
10 citizen states address provided was incorrect, request will be res…
# … with 90 more rows</code></pre>
</div>
<p>It worked! No more partial word matches.</p>
<p>Running the new code converted an additional 163 rows to NA. This is because some rows contained a resolution code different from the one entered in the <code>rc</code> or <code>rcm</code> column.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>newNA2</span> <span class='op'>&lt;-</span> <span class='va'>dupCode2</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>num</span>, by <span class='op'>=</span> <span class='st'>"sr"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>sr</span>, <span class='va'>rc.x</span>, <span class='va'>rcm.x</span>, <span class='va'>rs.y</span>, <span class='va'>rs.x</span><span class='op'>)</span>

<span class='va'>newNA2</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter-joins.html'>anti_join</a></span><span class='op'>(</span><span class='va'>newNA</span>, by <span class='op'>=</span> <span class='st'>"sr"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 163 × 5
        sr rc.x       rcm.x                        rs.y          rs.x 
     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;                        &lt;chr&gt;         &lt;chr&gt;
 1 4523704 npa-active keeps the file open in the … jw-dm         &lt;NA&gt; 
 2 5419850 uc         uncooperative                no one home   &lt;NA&gt; 
 3 5057458 npa-active keeps the file open in the … jw-dm         &lt;NA&gt; 
 4 2948636 npa-active keeps the file open in the … justified, a… &lt;NA&gt; 
 5 5387258 nj         case not justified           uncooperative &lt;NA&gt; 
 6 5330236 vom        v.o. for miscellaneous       cvoid         &lt;NA&gt; 
 7 4523696 shelby     shelby county owned propert… jw-dm         &lt;NA&gt; 
 8 5466094 vom        v.o. for miscellaneous       no one home.  &lt;NA&gt; 
 9 5423480 cvoid      closed void                  uncooperative &lt;NA&gt; 
10 5423738 cvoid      closed void                  uncooperative &lt;NA&gt; 
# … with 153 more rows</code></pre>
</div>
<p>For this reason, in future instances I will use <code>str_extract()</code> to create a new resolution code column before using <code>str_remove()</code>.</p>
<p>However, I’m not finished; I still need to catch partial code matches like “not justified” from the resolution summary.</p>
<h4 id="manual-resolution-codes">Manual resolution codes</h4>
<p>The easiest method to remove these additional matches (as far as I know) is to create my own list of codes and add it to the list of values to be extracted. The first portion of the list is existing codes that have been slightly reworded; the second half is new resolution codes I’ve created.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vNewRC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='co'>#' existing code, minor changes</span>
  <span class='st'>"active npa case"</span>,
  <span class='st'>"npa active"</span>,
  <span class='st'>"(complaint )?not justified"</span>,
  <span class='st'>"please contact the (shelby )?county land bank at for further information"</span>,
  <span class='st'>"please contact (shelby )?county for additional assistance"</span>,
  <span class='st'>"(shelby )?county (owned )?property"</span>,
  <span class='st'>"scop"</span>,
  <span class='st'>"justified active"</span>,
  <span class='st'>"dismissed"</span>,
  <span class='st'>"no cooperation"</span>,
  <span class='st'>"(property )?demolish(ed)?( by owner)?"</span>,
  <span class='st'>"rehabilitation by the owner"</span>,
  <span class='st'>"(property )?rehab(ilitat|b)ed"</span>,
  <span class='st'>"npa court order demo"</span>,
  <span class='st'>"jwdm"</span>,
  <span class='co'>#' new codes</span>
  <span class='st'>"(the|all)?( )?violation(s)? ((has|have) been )?corrected"</span>,
  <span class='st'>"(yard|property)?( )?(was )?(not )?in[ -]?compliance"</span>,
  <span class='st'>"no(t a)? (code|grass|yard|vehicle) violation"</span>,
  <span class='st'>"no(t in)? violation(s)?"</span>,
  <span class='st'>"(all issues have been )?resolved"</span>,
  <span class='st'>"repaired"</span>,
  <span class='st'>"repairs (have been|were)?( )?made"</span>,
  <span class='st'>"corrected"</span>,
  <span class='st'>"all is ok"</span>,
  <span class='st'>"mowed"</span>,
  <span class='st'>"grass (has been )?cut"</span>,
  <span class='st'>"yard (was )?clean(ed)?"</span>,
  <span class='st'>"(the )?vehicle(s)? (was)?removed"</span>,
  <span class='st'>"created in error"</span>,
  <span class='st'>"training"</span>,
  <span class='st'>"wrong address"</span>,
  <span class='st'>"duplicate"</span>,
  <span class='st'>"reissued"</span>,
  <span class='st'>"condemnation hearing"</span>,
  <span class='st'>"move to condemnation department"</span>,
  <span class='st'>"administrative referral"</span>,
  <span class='st'>"commercial( property)?"</span>,
  <span class='st'>"(shelby county )?tax sale"</span>,
  <span class='st'>"could not access the property"</span>,
  <span class='st'>"no access to property"</span>,
  <span class='st'>"tenant moved"</span>
  <span class='op'>)</span>

<span class='va'>vRC2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\b"</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>vRC</span>, <span class='va'>vNewRC</span><span class='op'>)</span>, <span class='st'>"\\b"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span>collapse <span class='op'>=</span> <span class='st'>"|"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>This list is by no means comprehensive or perfect, but it’s a good start. We can further refine it later. Now let’s rerun our code one last time using our new list of values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dupCode3</span> <span class='op'>&lt;-</span> <span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    rc2 <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vRC2</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vRC2</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"( )*\\$|\\("</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>rs</span>,
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>rs</span>
    <span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_squish</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Let’s see how many new rows are <em>NA</em>, meaning all information has been extracted from the resolution summary.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>newNA3</span> <span class='op'>&lt;-</span> <span class='va'>dupCode3</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>num</span>, by <span class='op'>=</span> <span class='st'>"sr"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>sr</span>, <span class='va'>rc.x</span>, <span class='va'>rcm.x</span>, <span class='va'>rs.y</span>, <span class='va'>rs.x</span><span class='op'>)</span>

<span class='va'>newNA3</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter-joins.html'>anti_join</a></span><span class='op'>(</span><span class='va'>newNA2</span>, by <span class='op'>=</span> <span class='st'>"sr"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5,815 × 5
        sr rc.x       rcm.x                       rs.y           rs.x 
     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;                       &lt;chr&gt;          &lt;chr&gt;
 1 2731732 npa-active keeps the file open in the… administrativ… &lt;NA&gt; 
 2 2621056 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
 3 2677350 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
 4 4299426 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
 5 2733374 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
 6 2620298 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
 7 2866626 cr         closed, rehab               rehabilitatio… &lt;NA&gt; 
 8 3749828 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
 9 4698796 npa-active keeps the file open in the… active npa ca… &lt;NA&gt; 
10 4903736 cvom       comp. v.o. - miscellaneous  resolved, ten… &lt;NA&gt; 
# … with 5,805 more rows</code></pre>
</div>
<p>The custom list of resolution codes converted another 5,815 rows to <em>NA</em> since the last run, bringing our total to 17,081 for this post.</p>
<p>Let’s see the most common information that remains in the resolution summary.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>todo3</span> <span class='op'>&lt;-</span> <span class='va'>dupCode3</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>todo3</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 14,540 × 2
   rs                             n
   &lt;chr&gt;                      &lt;int&gt;
 1 at time of inspection       1155
 2 at the time of inspection   1110
 3 at the time of recheck       294
 4 at time of inspection.       262
 5 per inspector james          211
 6 per inspection               206
 7 at time of recheck.          205
 8 at time of inspection (jn)   180
 9 per inspector walker         177
10 per inspector burton         171
# … with 14,530 more rows</code></pre>
</div>
<p>The most common resolution summaries remaining largely fall into two categories: indication that a property was inspected or rechecked; or the name of the inspector who updated the service request. I plan to address these issues in the next post. This will further heavily cut down on the amount of information remaining in the resolution summary.</p>
<h2 id="final-code">Final Code</h2>
<p>To finish out, I’ll combine all the relevant steps from above so I can easily copy and paste this code for future use. The first step is to create my list of resolution codes to extract.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>RC</span> <span class='op'>&lt;-</span> <span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rc</span>, <span class='va'>rcm</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>rcm</span>, <span class='va'>rc</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"remo"</span>, values_to <span class='op'>=</span> <span class='st'>"rcs"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>rcs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>rcs</span> <span class='op'>!=</span> <span class='st'>"shelby"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>vRC0</span> <span class='op'>&lt;-</span> <span class='va'>RC</span><span class='op'>$</span><span class='va'>rcs</span>

<span class='va'>vNewRC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='co'>#' existing code, minor changes</span>
  <span class='st'>"active npa case"</span>,
  <span class='st'>"npa active"</span>,
  <span class='st'>"(complaint )?not justified"</span>,
  <span class='st'>"please contact the (shelby )?county land bank at for further information"</span>,
  <span class='st'>"please contact (shelby )?county for additional assistance"</span>,
  <span class='st'>"(shelby )?county (owned )?property"</span>,
  <span class='st'>"scop"</span>,
  <span class='st'>"justified active"</span>,
  <span class='st'>"dismissed"</span>,
  <span class='st'>"no cooperation"</span>,
  <span class='st'>"(property )?demolish(ed)?( by owner)?"</span>,
  <span class='st'>"rehabilitation by the owner"</span>,
  <span class='st'>"(property )?rehab(ilitat|b)ed"</span>,
  <span class='st'>"npa court order demo"</span>,
  <span class='st'>"jwdm"</span>,
  <span class='co'>#' new codes</span>
  <span class='st'>"(the|all)?( )?violation(s)? ((has|have) been )?corrected"</span>,
  <span class='st'>"(yard|property)?( )?(was )?(not )?in[ -]?compliance"</span>,
  <span class='st'>"no(t a)? (code|grass|yard|vehicle) violation"</span>,
  <span class='st'>"no(t in)? violation(s)?"</span>,
  <span class='st'>"(all issues have been )?resolved"</span>,
  <span class='st'>"repaired"</span>,
  <span class='st'>"repairs (have been|were)?( )?made"</span>,
  <span class='st'>"corrected"</span>,
  <span class='st'>"all is ok"</span>,
  <span class='st'>"mowed"</span>,
  <span class='st'>"grass (has been )?cut"</span>,
  <span class='st'>"yard (was )?clean(ed)?"</span>,
  <span class='st'>"(the )?vehicle(s)? (was)?removed"</span>,
  <span class='st'>"created in error"</span>,
  <span class='st'>"training"</span>,
  <span class='st'>"wrong address"</span>,
  <span class='st'>"duplicate"</span>,
  <span class='st'>"reissued"</span>,
  <span class='st'>"condemnation hearing"</span>,
  <span class='st'>"move to condemnation department"</span>,
  <span class='st'>"administrative referral"</span>,
  <span class='st'>"commercial( property)?"</span>,
  <span class='st'>"(shelby county )?tax sale"</span>,
  <span class='st'>"could not access the property"</span>,
  <span class='st'>"no access to property"</span>,
  <span class='st'>"tenant moved"</span>
  <span class='op'>)</span>

<span class='va'>vRC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"\\b"</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>vRC0</span>, <span class='va'>vNewRC</span><span class='op'>)</span>, <span class='st'>"\\b"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span>collapse <span class='op'>=</span> <span class='st'>"|"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Step two is to extract this list of codes into their own column and remove them from the resolution summary.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>newRC</span> <span class='op'>&lt;-</span> <span class='va'>num</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    rc2 <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vRC</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='va'>vRC</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"( )*\\$|\\("</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>rs</span>,
      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_starts.html'>str_starts</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove_all</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>"^\\W+"</span><span class='op'>)</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>rs</span>
    <span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_squish</a></span><span class='op'>(</span><span class='va'>rs</span><span class='op'>)</span>,
    rs <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='va'>rs</span>, <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>All done! As I said above, this is not a comprehensive or final list of resolution codes, but it does clean out over 17,000 rows, approximately 36% of the original <code>zCE</code> dataset. Recall that the last post cleared out nearly 5% of resolution summaries. In total, nearly 41% of all rows in the <code>zCE</code> dataset have had all information extracted from the resolution summary. This is a major step towards having a tidy dataset that will be much easier to analyze and work with.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/sj-io/sj-distill/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>

---
title: "Housing Units"
description: |
  Exploring and visualizing the number of housing units in the Memphis metro area.
date: 2021-10-27
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_float: true
    code_download: true
repository_url: https://github.com/sj-io/sj-distill
base_url: https://sarahjohnson.io
bibliography: references.bib
csl: chicago-fullnote-bibliography-16th-edition.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  R.options = list(width = 60)
)
```

# Intro

In my [last post](https://sarahjohnson.io/posts/2021-10-22-boundaries/), I explored all Census boundaries related to Memphis. This post uses Census data to fill in those boundaries to begin understanding the Memphis housing market.

First I briefly explain and compare two Census programs that provide estimates of housing units. Then I use 5-year American Community Survey estimates to map the number of housing units in the Memphis area.

According to the 2015-2019 5-Year ACS, there are 567,073 housing units in the Memphis metro area; 405,184 within Shelby County; and 299,913 within the city of Memphis. In total, over half of the housing units in the metro region are within the city limits.

```{r library}
library(tidyverse)
library(tidycensus)
library(sf)
library(rmarkdown)
library(plotly)
library(ggiraph)
library(patchwork)
library(mapview)
```

# Census Surveys & Programs

For the foreseeable future, posts on this blog will use Census data to understand Memphis' housing market. The amount of Census data available can be overwhelming, with [over 130 surveys and programs](https://www.census.gov/programs-surveys/surveys-programs.html) conducted each year. This section will discuss the American Community Survey and Population Estimates Program, both of which provide annual data on population and housing units.

## American Community Survey

While all Americans are likely aware of the decennial Census, the **American Community Survey** (**ACS**) has become the "premier source for detailed population and housing information about our nation."[@uscensusbureau2021] Unlike the decennial Census, which attempts to count every person living in the US, ACS estimates are derived from an annual sample of about 3.5 million addresses. There are [nearly 50 subjects](https://www.census.gov/programs-surveys/acs/guidance/subjects.html) included in the ACS, with sub-tables available for each subject, leading to tens of thousands of detailed variables.

Every year, the Census Bureau releases a 1-year and a 5-year version of the ACS. The **1-year** estimates are collected over a 12-month period for areas with at least 65,000 people, and have a higher margin of error; **5-year** estimates are for areas with fewer than 65,000 people over a period of 60 months, and have a lower margin of error.[@uscensusbureau2020] ACS 5-year estimates should be labeled to show all years data was collected, not just the midpoint or year the dataset was released (for example "2015-2019 ACS 5-Year" is correct but not "2017 ACS 5-Year" or "2019 ACS 5-Year").

When comparing data over time, the Census Bureau recommends using 1-year data, or to compare 5-year estimates that do not overlap, such as 2009-2013 estimates and 2014-2018 estimates. Five-year estimates are more precise, but they are also less likely to show year-to-year fluctuations or recent trends.[@uscensusbureau2020] Users should also [research](www.census.gov/programs-surveys/acs/guidance /comparing-acs-data.html) how ACS questions have changed over time, and whether certain variables/time frames should or should not be compared.

Lastly, the 2020 Census ran into significant data collection problems due to COVID. As such, the Census Bureau will not release its standard 2020 ACS 1-year estimates. Instead, [experimental estimates](https://www.census.gov/programs-surveys/acs/data/experimental-data.html) developed from the 1-year data will be released later this year. The 5-year ACS will still be released as normal.

## Population Estimates Program

The ACS was designed to provide information about the *characteristics* of a population, rather than basic counts of population and housing.[@uscensusbureau2020] The Census Bureau recommends that this data should instead be collected from the [Population Estimates Program](https://www.census.gov/programs-surveys/popest.html) (**PEP**), available for states, metro/micro areas, counties, and places.

Rather than being based on a survey, the PEP estimates population by using the most recent decennial Census, combined with administrative records on birth, death, and migration rates.[@walker2021] Housing unit estimates are determined by new residential construction, new mobile homes, and the estimated number of housing units lost.[@uscensusbureau2019]

![Census methodology to estimate housing units for the PEP. ([Census Bureau](https://www.census.gov/programs-surveys/acs/guidance/handbooks/general.html))](HUEST.png)

PEP estimates are used as controls for other surveys including the ACS, American Housing Survey, and Housing Vacancy Survey.

## Comparison

The Census recommends the PEP over the ACS for basic counts of population and housing. However, if you plan to also look at detailed characteristic data, the Census recommends using the ACS throughout your analysis (basically, don't mix PEP and ACS estimates).[^1]

[^1]: For more information on when to use the ACS vs the PEP, see the Census webinar/presentation/transcript: [Comparing the American Community Survey and the Population Estimates Program](https://www.census.gov/data/academy/webinars/2021/comparing-the-acs-and-the-pop-est-program.html).

I was conflicted on which dataset to use---for *this* post I only plan to look at housing unit estimates, but in *future posts* I will add in detailed characteristic data. It was only while writing this post that I learned the Bureau recommends the PEP for basic counts, after I had made all the maps/tables using ACS data. So I decided to see how the ACS and PEP data compare, in case I needed to recreate the maps using PEP data.

Below is an interactive graph comparing ACS and PEP estimates of the number of housing units in Shelby County from 2010 to 2019. Though ACS 5-Year estimates are not really recommended for yearly time series, I included it for curiosity. Clicking on a dataset in the legend will show/hide the line.

```{r PEP, include=FALSE}
years <- 2010:2019

#' https://www.census.gov/data/developers/data-sets/popest-popproj/popest/popest-vars/2019.html for DATE code definitions and to see why I filtered out the first two rows

PEP <- get_estimates(
  geography = "county",
  product = "housing",
  state = "TN",
  county = "Shelby",
  time_series = TRUE
) %>%
  filter(DATE >= 3) %>%
  mutate(year = years,
         dataset = "PEP",
         estimate = value) %>% 
  select(-c(DATE, value))
```

```{r ACS1, include=FALSE}
ACS1 <- map_dfr(years, ~ {
  get_acs(
    geography = "county",
    survey = "acs1",
    variables = "B25001_001",
    state = "TN",
    county = "Shelby",
    year = .x,
    cache_table = TRUE
  )
}, .id = "year") %>%
  mutate(year = years,
         dataset = "ACS1")
```

```{r ACS5, include=FALSE}
ACS5 <- map_dfr(years, ~ {
  get_acs(
    geography = "county",
    survey = "acs5",
    variables = "B25001_001",
    state = "TN",
    county = "Shelby",
    year = .x,
    cache_table = TRUE
  )
}, .id = "year") %>%
  mutate(year = years,
         dataset = "ACS5")
```

```{r hsg}
hsg <- PEP %>% 
  full_join(ACS1) %>% 
  full_join(ACS5)
```

```{r hsgPlot}
gg <- ggplot(hsg, aes(x = year, y = estimate, color = dataset)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = unique(hsg$year)) +
  labs(title = "Housing Units in Shelby County, 2010-2019",
       y = "Estimate",
       x = "Year",
       color = "Dataset") +
  theme_light()

ggplotly(gg)
```

Presently, the ACS 1-Year and PEP estimates are near identical; there was only a 30-unit difference in 2019 values. There was a bit of variation in 2011 and 2014-2016, mostly with the ACS overestimating the PEP values, but the variation was never more than 1,882 units (\<0.5% of total estimate). Yet while the counts have been similar, the PEP values gradually increased over the decade while the ACS was more erratic, fluctuating downward in 2011 and 2017.

Meanwhile, the ACS 5-Year is more smooth than the 1-year data, with no downward fluctuations. But we can clearly see how the values lag behind the ACS 1-Year and PEP data. Five-year values are more representative of the midpoint year than the release year. For instance, 2015-2019 data is more representative of 2017 estimates than 2019.

The variations in ACS and PEP data were not large enough to make me feel the need to recreate the below tables/maps with PEP data. Since I plan to build on this post in the future with detailed characteristic data, I feel more comfortable sticking with ACS data. I also want to analyze down to at least the tract level, which is not available with PEP data.

The remainder of this post will use the most recent 5-year ACS dataset. I'm using the 5-year dataset over the 1-year because the margin of error is smaller, which is particularly important when I'm analyzing smaller geographies, and I'll only be analyzing one year, rather than a time series. Each dataset has its trade-offs, and hopefully the differences have been made clear.

# Metro Area

As seen in the [last post](https://sarahjohnson.io/posts/2021-10-22-boundaries/), a metro/micro area (also called a core-based statistical area/cbsa) is the broadest way to define a local area.[^2] It is made up of counties surrounding an urban core with a high degree of social and economic integration.

[^2]: Technically there is one level higher: multiple nearby CBSAs will be grouped together into a combined statistical area (CSA).

I want to know how many housing units are in the Memphis metro area. However, this data point will not have much significance unless we have something to compare it to. The following table lists the top 50 metro areas in the US by number of housing units.[^3]

[^3]:  Apologies for the lack of commas and rank numbers. This was just meant to be a quick table.

```{r hsgUnitsMetro, include=FALSE}
hsgUnitsMetro <- get_acs(
  geography = "cbsa",
  variables = "B25001_001",
  cache_table = TRUE
) %>%
  slice_max(estimate, n = 50)
```

```{r metroTbl}
metros <- hsgUnitsMetro %>% 
  select(NAME, estimate) %>% 
  mutate(NAME = str_remove(NAME, "-.*$")) %>% 
  mutate(NAME = str_remove(NAME, ",.*$")) 

paged_table(metros)
```

According to the 2015-2019 5-Year ACS, there are 567,073 housing units in the Memphis metro. Memphis ranks 43rd in the US for the number of housing units in a metro area, between Oklahoma City and New Orleans. Nashville, Memphis' mortal enemy, ranks 36th with 769,974 units.

Let's zoom in on Memphis and look at how housing units are distributed across counties within the metro. The below map shows the number of housing units in each county in the Memphis metro area. Hover over a county to see the estimate.

```{r cbsa, include=FALSE}
cbsa <- get_acs(geography = "cbsa",
                variables = "B25001_001",
                geometry = TRUE,
                cache_table = TRUE) %>% 
  filter(str_detect(NAME, "Memphis"))
memST <- list("TN", "MS", "AR")
```

```{r hsgUnitsCounties, include=FALSE}
hsgUnitsCounties <- map_dfr((memST), ~ {
  get_acs(
    geography = "county",
    state = .x,
    variables = "B25001_001",
    geometry = TRUE,
    cache_table = TRUE
  )
}) %>% 
  st_filter(cbsa, .predicate = st_within) %>% 
  mutate(area = as.numeric(st_area(geometry)),
         density = estimate / area)
```

```{r eval=FALSE, include=FALSE}
#' not run: PEP cbsa county data, to make sure other counties besides Shelby weren't significantly different from ACS data.

hsgMetro <- map_dfr((memST), ~ {
  get_estimates(geography = "county",
                state = .x,
                product = "housing",
                geometry = TRUE)
}) %>% 
  st_filter(cbsa, .predicate = st_within) %>% 
  mutate(area = as.numeric(st_area(geometry)),
         density = value / area)
```

```{r metroCounties}
metroMap <- ggplot(hsgUnitsCounties, aes(fill = estimate)) +
  geom_sf_interactive(aes(tooltip = estimate, data_id = GEOID), size = 0.1) +
  scale_fill_viridis_c(option = "plasma", guide = "none") +
  theme_void()

metroPlot <- ggplot(hsgUnitsCounties, aes(x = estimate, y = reorder(NAME, estimate), 
                                          fill = estimate)) +
  geom_point_interactive(color = "black", size = 4, shape = 21, aes(data_id = GEOID)) +
  scale_fill_viridis_c(option = "plasma", labels = scales::comma) +
  scale_x_continuous(labels = scales::comma) +
  labs(title = "Housing units in Memphis Metro Area",
       subtitle = "2015-2019 American Community Survey",
       y = "",
       x = "ACS estimate",
       fill = "ACS estimate") +
  theme_minimal()

girafe(ggobj = metroMap + metroPlot, width_svg = 10, height_svg = 5) %>% 
  girafe_options(opts_hover(css = "fill:cyan;"))
```

Of the 567,073 housing units in the Memphis metro area, 405,184 (71%) are within Shelby County. The next largest county is DeSoto County, Mississippi, with 67,168 units. The smallest county is Tunica, with 4,915 units.

# Shelby County

Since over 70% of the housing units in the Memphis metro are in Shelby County, let's further explore where in the county most housing units are located. This section will break down the county by place, then tract.

## Places

```{r shelby}
shelby <- hsgUnitsCounties %>% filter(str_detect(NAME, "Shelby"))
```

```{r hsgUnitsPl, include=FALSE}
hsgUnitsPl <- get_acs(
  geography = "place",
  state = "TN",
  variables = "B25001_001",
  geometry = TRUE,
  cache_table = TRUE
  ) %>%
  st_filter(shelby, .predicate = st_within) %>% 
  mutate(area = as.numeric(st_area(geometry)),
         density = estimate / area,
         NAME = str_remove(NAME, "\\s.*$"))
```

Census places can be incorporated cities/towns, or unincorporated statistical areas. In Shelby County, all places are legally incorporated.

The following map shows how many housing units are in each place within Shelby County.

```{r placeMap}
placeMap <- ggplot(hsgUnitsPl, aes(fill = estimate)) +
  geom_sf_interactive(aes(tooltip = estimate, data_id = GEOID), size = 0.1) +
  scale_fill_viridis_c(option = "plasma", guide = "none") +
  theme_void()

placePlot <- ggplot(hsgUnitsPl, aes(x = estimate, y = reorder(NAME, estimate), 
                                          fill = estimate)) +
  geom_point_interactive(color = "black", size = 4, shape = 21, aes(data_id = GEOID)) +
  scale_fill_viridis_c(option = "plasma", labels = scales::comma) +
  scale_x_continuous(labels = scales::comma) +
  labs(title = "Housing units in Shelby County",
       subtitle = "2015-2019 American Community Survey",
       y = "",
       x = "ACS estimate",
       fill = "ACS estimate") +
  theme_minimal()

girafe(ggobj = placeMap + placePlot, width_svg = 10, height_svg = 5) %>% 
  girafe_options(opts_hover(css = "fill:cyan;"))
```

Once again, we see most housing units are mostly concentrated in one area, rather than being evenly distributed across the region. Of the 405,184 housing units in Shelby County, 299,913 (74%) are within the city of Memphis.

It is important to point out that large sections of Shelby County remain unincorporated yet also contain housing units. In total, 366,901 (91%) housing units are within a city or town in Shelby County, while 38,283 (9%) units are in the unincorporated County.

## Tracts

Let's continue to narrow our scope by looking at Census tract data.

```{r hsgUnitsSC, include=FALSE}
hsgUnitsSC <- get_acs(
  geography = "tract",
  state = "TN",
  county = "Shelby",
  variables = "B25001_001",
  geometry = TRUE,
  cache_table = TRUE
) %>%
  mutate(area = as.numeric(st_area(geometry)),
         density = estimate / area)
```

The below maps show the number of housing units in each Census tract in Shelby County. The first map shows the estimated number of units in each tract. However, the tracts with the most housing units are also geographically large. The second map shows the density of housing units in each tract, AKA the number of housing units divided by the area of the tract (measured in meters).

```{r tract, fig.show='hold', out.width='50%', preview=TRUE}
plot(hsgUnitsSC["estimate"]) 
plot(hsgUnitsSC["density"])
```

The density map shows most housing units are concentrated in tracts within the city of Memphis. While there are high levels of density in older parts of the city like Downtown and Midtown, the densest tract is in the southeast portion of the city, closer to Germantown than Downtown. As it turns out, there's a high concentration of apartment complexes in this area.

Below is an interactive version of the density map.

```{r mapview, layout='l-page', fig.height=6}
mapview(hsgUnitsSC, zcol = "density", legend = FALSE)
```

Clicking the layers button in the upper left corner allows you to change the map background; switch to **Esri.WorldImagery** for a satellite view, where you can see all the homes/apartment complexes. The OpenStreetMap layer also allows you to zoom in and see where buildings are located. Click on a tract to see more info, like the exact estimate and Census tract number.

# Summary Table

The below table summarizes the number of housing units in the Memphis area based on the 2015-2019 ACS. Remember, this data is more representative of 2017 than 2019.

| Area               | Estimate | \% Metro | \% County |
|--------------------|----------|----------|-----------|
| Memphis Metro Area | 567,073  | 100%     | \-        |
| Shelby County      | 405,184  | 71.45%   | 100%      |
| Memphis            | 299,913  | 52.89%   | 74.02%    |

: Housing units in Memphis area, 2015-2019 5-Year ACS

In the Memphis Metro area, the majority of housing units are within Shelby County, and most of those units are within the city of Memphis. In total, over half of the housing units in the metro region are within the city limits.

The Census tract with the most units lies on the edge of the county, but the densest tracts are closer to the city core. The densest tract is in the southeastern corner of the city, where there is a high concentration of apartment complexes.

# Acknowledgements {.appendix}

Once again, I heavily referenced the book [Analyzing US Census Data](https://walker-data.com/census-r/index.html) by Kyle Walker to make this post. The line graph comparing Census datasets was influenced by [Chapter 4](https://walker-data.com/census-r/exploring-us-census-data-with-visualization.html#visualizing-acs-estimates-over-time), including introducing me to the **plotly** package for interactive graphs. For the maps I referenced [Chapter 6](https://walker-data.com/census-r/mapping-census-data-with-r.html), particularly for how to use the **ggiraph** package.
